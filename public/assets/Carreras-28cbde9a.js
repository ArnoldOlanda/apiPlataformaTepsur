import{U as K,b as e,r as h,g as q,e as ie,ai as j,aC as ce,aj as k,ae as H,s as V,o as $,ad as U,aD as re,j as p,n as E,ar as ue,B as Q,T as oe,V as me,ao as he,l as R,Q as pe,y as ae,p as B,q as ne,u as ge,a as be}from"./index-b05c3593.js";import{a as fe,g as xe,b as Ce,e as ye,d as Me}from"./careers.service-c54b684b.js";import{g as Se}from"./GlobalAlerts-e291f7f6.js";import{a as T,T as i,b as G,c as J,t as Y}from"./TableRow-52fc41de.js";import{E as te}from"./Edit-18203eee.js";import{D as le}from"./Delete-e33b6966.js";import{T as X}from"./TableHead-f4539647.js";import{T as se}from"./TableContainer-10b5223d.js";import{S as Z}from"./SelectCustom-ab67c468.js";import{A as Ie}from"./Add-1cbcdd1e.js";import{C as ve}from"./CaptionBox-53db12e8.js";import{I as F}from"./InputAdornment-b1693cda.js";import{L as ee}from"./LoadingButton-caa486e8.js";import{P as Ae}from"./Page-87bac860.js";import{C as we}from"./CustomSelectSearchLabel-0730f57a.js";import"./TableCRUDMini-8ef25830.js";import"./MenuItem-d8a67f6c.js";import"./Info-b8afdcbc.js";import"./CircularProgress-eeae7465.js";import"./Autocomplete-7a426b1a.js";import"./Tooltip-8a46e05f.js";import"./RowCRUD-b35830b8.js";const De=K(e("path",{d:"M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"DragIndicator"),Te=K(e("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"}),"KeyboardArrowDown"),Ee=K(e("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp"),ze=(l={})=>{const[r,t]=h.useState(l),{token:b}=q(a=>a.user),n=ie(),[o,s]=h.useState([]),[x,M]=h.useState([]),{createAlert:A,editAlert:c,deleteAlert:u}=Se();return{...r,formState:r,onInputChange:({target:a})=>{const{name:d,value:I}=a;t({...r,[d]:I})},onResetForm:()=>{t(l)},getListCareers:async()=>{try{n(j());const a=await fe(b);return s(a||[]),n(k()),a||[]}catch(a){H(a),n(k())}},addModule:a=>{t({...r,modulos:[...r.modulos,a],nombreMod:"",duracion:"",selectIdMod:null})},delModule:a=>{t({...r,modulos:[...r.modulos.filter(d=>d.uuid!=a)]})},editModule:async(a,d)=>{const I=r.modulos.map(g=>g.uuid==a?{...g,...d}:g);await t({...r,modulos:I,selectIdMod:null})},onAddCareer:async a=>{A("esta carrera","Carrera Registrada",async()=>{try{const d=[];r.modulos.forEach((g,m)=>{d.push({orden:m+1,nombre:g.nombre,duracionSemanas:g.duracion_semanas})}),n(V());const I=await Ce({...r,modulos:d});s([...o,I]),n($())}catch(d){throw d}},a)},data:o,setFormState:t,onEditCareer:async a=>{c("esta carrera",async()=>{try{const d=r.modulos.map((g,m)=>({uuid:g.uuid.length>10?g.uuid:void 0,nombre:g.nombre,duracionSemanas:g.duracion_semanas,orden:m}));n(V());const I=await ye({...r,token:b,modulos:d,id:r.selectId});s([...o.map(g=>g.uuid==I.uuid?I:g)]),n($())}catch(d){throw d}},a)},getListAllModules:async()=>{try{n(j());const a=await ce({...r,token:b});M(a||[]),n(k())}catch(a){n(k()),H(a)}},getListCareersBySede:async a=>{try{n(j());const d=await xe(b,a);return s(d),n(k()),o||[]}catch(d){H(d),n(k())}},modulos:x,onResetFormModule:()=>{t({...r,token:b,selectIdMod:null,nombreMod:"",duracion:"",horarios:[]})},onDeleteCareer:async(a,d)=>{u("esta carrera","Carrera Eliminada",async()=>{try{n(V());const I=await Me(a,r.token);s([...o.filter(g=>g.uuid!=a)]),n($())}catch(I){throw I}},d)}}};function ke({id:l,row:r,handleOpen:t,onDelete:b}){const[n,o]=re.useState(!1);return p(h.Fragment,{children:[p(T,{sx:{"& > *":{borderBottom:"unset"}},children:[e(i,{children:e(E,{"aria-label":"expand row",size:"small",onClick:()=>o(!n),children:n?e(Ee,{}):e(Te,{})})}),e(i,{align:"center",children:r.nombre}),e(i,{align:"center",children:r.tipo_carrera}),e(i,{align:"center",children:r.duracion_meses}),e(i,{align:"center",children:r.num_modulos}),p(i,{align:"center",children:[e(E,{size:"small",onClick:()=>t(r.uuid),children:e(te,{})}),e(E,{size:"small",onClick:()=>b(r.uuid),children:e(le,{})})]})]}),e(T,{sx:{},children:e(i,{style:{paddingBottom:0,paddingTop:0},colSpan:7,children:e(ue,{in:n,timeout:"auto",unmountOnExit:!0,children:p(Q,{sx:{margin:1},children:[e(oe,{variant:"body1",gutterBottom:!0,component:"div",children:"Modulos"}),p(G,{size:"small",children:[e(X,{children:p(T,{children:[e(i,{children:"id"}),e(i,{align:"right",children:"Nombre"}),e(i,{align:"right",children:"Duración (Semanas)"})]})}),e(J,{children:r.modulos.map((s,x)=>p(T,{children:[e(i,{component:"th",scope:"row",children:x+1}),e(i,{align:"right",children:s.nombre}),e(i,{align:"right",children:s.duracion_semanas})]},`${r.nombre}/modulo/${x}`))})]})]})})})})]})}U(T)(({theme:l})=>({"&:nth-of-type(odd)":{backgroundColor:l.palette.action.hover},"&:last-child td, &:last-child th":{border:0}}));const Le=({data:l=[],handleOpen:r,onDelete:t})=>e(se,{component:me,children:p(G,{size:"small","aria-label":"simple table",children:[e(X,{children:p(Be,{children:[e(L,{}),e(L,{align:"center",children:"Nombre"}),e(L,{align:"center",children:"Tipo"}),e(L,{align:"center",children:"Duración (meses)"}),e(L,{align:"center",children:"Modulos"}),e(L,{align:"center",children:"Acciones"})]})}),e(J,{children:l.length!=0&&l.map((b,n)=>e(ke,{handleOpen:r,onDelete:t,id:n,row:b},`row${n}`))}),l.length==0&&e("caption",{style:{textAlign:"center"},children:"No hay datos para mostrar"})]})}),L=U(i)(({theme:l})=>({[`&.${Y.head}`]:{backgroundColor:l.palette.common.black,color:l.palette.common.white},[`&.${Y.body}`]:{fontSize:14}})),Be=U(T)(({theme:l})=>({"&:nth-of-type(odd)":{backgroundColor:l.palette.action.hover},"&:last-child td, &:last-child th":{border:0}})),Re=({index:l,module:r,delModule:t,editModule:b,handleDragStart:n,handleDragOver:o,handleDragEnd:s})=>p(T,{onDragStart:()=>n(r),onDragOver:()=>o(r),onDragEnd:s,draggable:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e(i,{children:e(E,{children:e(De,{})})}),e(i,{children:e(he,{primary:l})}),e(i,{children:e(oe,{sx:{maxWidth:100,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:r.nombre})}),e(i,{flex:1,align:"right",children:e(R,{flexDirection:"row",alignItems:"center",justifyContent:"flex-end",children:p(pe,{children:[e(E,{onClick:()=>b(r.uuid),children:e(te,{})}),e(E,{onClick:()=>t(r.uuid),children:e(le,{})})]})})})]}),Oe=({tableRef:l,onInputChange:r,formState:t,delModule:b,editModule:n,handleOpenModule:o})=>{const[s,x]=h.useState(null),M=u=>{x(u)},A=u=>{if(s.uuid!=u.uuid){const C=[...t.modulos],v=t.modulos.indexOf(s),w=t.modulos.indexOf(u);C.splice(v,1),C.splice(w,0,s),r({target:{name:"modulos",value:C}})}},c=()=>{x(null)};return e(se,{sx:{maxHeight:200,mt:2,minWidth:300},children:p(G,{ref:l,stickyHeader:!0,size:"small","aria-label":"a dense table",sx:{width:"100%",maxHeight:"200px"},children:[e(X,{children:p(T,{children:[e(i,{}),e(i,{children:"Orden"}),e(i,{children:"Módulo"}),e(i,{align:"right",children:e(E,{onClick:o,sx:{border:"0px dashed black"},children:e(Ie,{})})})]})}),e(J,{children:t.modulos.length!=0&&t.modulos.map((u,C)=>e(Re,{handleDragEnd:c,handleDragOver:A,handleDragStart:M,index:C+1,delModule:b,editModule:n,module:u},`moduloD${C}`))}),t.modulos.length==0&&e("caption",{style:{textAlign:"center"},children:" Agrega modulos con el boton +"})]})})},_e=({open:l,handleClose:r,formCareer:t,handleOpenAdd:b,handleOpenModule:n,tableRefMod:o,sedes:s})=>{const{isLoading:x,user:M}=q(S=>S.user),A=[...s.map(S=>({label:S.nombre,value:S.uuid}))],{formState:c,onInputChange:u,delModule:C,onEditCareer:v,onAddCareer:w,setFormState:z}=t,y=S=>{S.preventDefault(),c.selectId?v(r):w(r)},f=S=>{n();const D=c.modulos.find(O=>O.uuid==S);z({...c,selectIdMod:S,nombreMod:D.nombre,duracion:D.duracion_semanas,horarios:D.horarios?D.horarios:[]})};return e(ae,{title:c.selectId?"Editar carrera":"Agregar carrera",open:l,handleClose:r,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:p(Q,{component:"form",sx:{maxHeight:"100%",overflow:"auto",display:"flex",flexDirection:"column",px:3,gap:1},onSubmit:y,children:[p(R,{flexDirection:"row",gap:3,flexWrap:"wrap",children:[p(R,{sx:{flex:1,minWidth:300,gap:"0px 24px",flexWrap:"wrap"},children:[e(B,{margin:"normal",sx:{flex:1,minWidth:"150px"},name:"nombre",label:"Nombre de la carrera",variant:"outlined",size:"small",color:"secondary",value:c.nombre,onChange:u,autoComplete:"nope",required:!0}),e(B,{autoComplete:"nope",margin:"normal",sx:{flex:1,minWidth:"150px"},name:"duracionMeses",label:"Duracion de la carrera",variant:"outlined",type:"number",size:"small",color:"secondary",value:c.duracionMeses,onChange:u,required:!0,InputProps:{endAdornment:e(F,{position:"end",children:"meses"})}}),e(Z,{required:!0,label:"Tipo de carrera",name:"tipo",opts:Fe,value:c.tipo,onChange:u}),e(Z,{required:!0,label:"Sede",name:"sede",value:c.sede,onChange:u,opts:A,disabled:M.rol!="root"}),e(B,{autoComplete:"nope",margin:"normal",sx:{flex:1,minWidth:"150px"},name:"tarifaPre",label:"Tarifa Presencial",variant:"outlined",type:"number",size:"small",color:"secondary",value:c.tarifaPre,onChange:u,required:!0,InputProps:{startAdornment:e(F,{position:"end",children:"S/."})}}),e(B,{autoComplete:"nope",margin:"normal",sx:{flex:1,minWidth:"150px"},name:"tarifaVir",label:"Tarifa Virtual",variant:"outlined",type:"number",size:"small",color:"secondary",value:c.tarifaVir,onChange:u,required:!0,InputProps:{startAdornment:e(F,{position:"end",children:"S/."})}}),e(ve,{text:"En caso no tenga definido alguna tarifa coloque 0."})]}),e(R,{flex:1,children:e(Oe,{tableRef:o,onInputChange:u,formState:c,delModule:C,editModule:f,handleOpenModule:n})})]}),c.selectId?e(ee,{loading:x,type:"submit",variant:"contained",color:"primary",sx:{flex:1,mt:2},children:"Editar Carrera"}):e(ee,{loading:x,type:"submit",variant:"contained",color:"primary",sx:{flex:1,mt:2},children:"Agregar Carrera"})]})})},Fe=[{label:"Semestral",value:"semestral"},{label:"Modular",value:"modular"}],qe=({open:l,handleClose:r,formCareer:t,tableRefMod:b,selected:n})=>{const{formState:o,onInputChange:s,addModule:x,editModule:M,setFormState:A}=t,[c,u]=h.useState(1),[C,v]=h.useState(o.nombreMod),w=({target:y})=>{v(y.value)},z=y=>{y.preventDefault(),o.selectIdMod?(M(o.selectIdMod,{uuid:o.selectIdMod,nombre:o.nombreMod,duracion_semanas:o.duracion}),r()):(x({uuid:c,nombre:o.nombreMod,duracion_semanas:o.duracion,horarios:o.horarios}),u(c+1),setTimeout(()=>{const f=b.current.children[1].lastElementChild;f&&f.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},0),r())};return h.useEffect(()=>{if(o.selectIdMod){const y=o.modulos.find(f=>f.uuid==o.selectIdMod);A({...o,nombreMod:y.nombre,duracion:y.duracion_semanas,horarios:y.horarios})}else A({...o,nombreMod:"",duracion:"",horarios:""})},[l]),h.useEffect(()=>{v(o.nombreMod)},[o.nombreMod]),e(ae,{open:l,handleClose:r,title:o.selectIdMod?"Editar modulo":"Agregar modulo",children:e("form",{style:{flex:1},onSubmit:z,children:p(Q,{sx:Pe,children:[e(B,{margin:"normal",sx:{flex:1,minWidth:"150px"},name:"nombreMod",label:"Nombre del modulo",variant:"outlined",size:"small",color:"secondary",value:C,onChange:w,onBlur:y=>{s(y)},required:!0}),e(B,{margin:"normal",sx:{flex:1,minWidth:"150px"},name:"duracion",type:"number",label:"Duracion del modulo",variant:"outlined",size:"small",color:"secondary",value:o.duracion,onChange:s,InputProps:{endAdornment:e(F,{position:"end",children:"semanas"})},required:!0}),e(ne,{type:"submit",variant:"contained",color:"primary",sx:{mt:2},children:"Aceptar"})]})})})},Pe={display:"flex",flexDirection:"column",width:400,px:3},dr=({toggleDrawer:l})=>{const[r,t]=h.useState(!1),[b,n]=h.useState(!1),[o,s]=h.useState(!1),{token:x,user:M,isLoading:A}=q(m=>m.user),c=ge();be(c.breakpoints.up("sm"));const{sedes:u}=q(m=>m.utilities),C=[...u.map(m=>({label:m.nombre,value:m.uuid}))],[v,w]=h.useState(M.rol?C[0].value:M.sede.uuid),z=({target:m})=>{w(m.value)},y={token:x,nombre:"",modalidad:"",numId:0,codUser:M.usuario.id,modulos:[],numIdSc:0,tipo:"",selectId:null,horarios:[],id:"",uuid:"",hora_inicio:"",hora_fin:"",turno:"",dias:[],selectIdMod:null,nombreMod:"",duracion:"",duracionMeses:"",tarifaPre:0,tarifaVir:0,sede:M.rol?"":M.sede.uuid},f=ze(y),{data:S}=f,D=h.useRef(null);h.useState([]),h.useState([]);const[O,P]=h.useState([]),W=()=>{n(!0)},N=m=>{if(m){const _=O.find(de=>de.uuid==m);f.setFormState({...f.formState,selectId:m,nombre:_.nombre,duracionMeses:_.duracion_meses,tipo:_.tipo_carrera,sede:v,modulos:_.modulos})}t(!0)},a=()=>{f.onResetForm(),t(!1)},d=()=>{f.onResetFormModule(),s(!0)},I=()=>{s(!1)},g=m=>{f.onDeleteCareer(m,a)};return h.useEffect(()=>{P(S)},[S]),h.useEffect(()=>{f.getListCareersBySede(v).then(m=>{P(m)})},[v]),re.useState([]),p(Ae,{toggleDrawer:l,title:"Carreras",Actions:e(ne,{onClick:()=>N(null),type:"submit",variant:"contained",color:"primary",sx:{mt:1,width:"100px"},children:" Agregar "}),children:[p(R,{flex:1,maxHeight:"100%",children:[e(R,{flexDirection:"row",gap:3,justifyContent:"space-between",alignItems:"center",children:e(we,{flex:0,mt:0,required:!0,label:"Sede",name:"sede",value:v,onChange:z,options:C})}),e(Le,{data:O,handleOpen:N,onDelete:g})]}),e(_e,{open:r,handleClose:a,formCareer:f,handleOpenAdd:W,handleOpenModule:d,tableRefMod:D,sedes:u}),e(qe,{open:o,handleClose:I,formCareer:f,handleOpenAdd:W,tableRefMod:D})]})};export{dr as default};
