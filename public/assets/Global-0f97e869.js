import{t as q,e as _,r as c,g as j,ai as $,aj as A,ae as T,s as I,o as N,ak as J,al as K,b as i,y as Q,B as O,j as w,p as V,l as U,m as X,T as Y,q as Z}from"./index-b05c3593.js";import{P as ee}from"./Page-87bac860.js";import{T as te}from"./TableCRUDMini-8ef25830.js";import{C as ae}from"./CustomActionCRUD-56f80e1a.js";import{g as oe}from"./GlobalAlerts-e291f7f6.js";/* empty css               */import{C as W}from"./CustomSelectSearch-f02217ed.js";import{f as re}from"./TextfieldsTools-ddad1e93.js";import{L as ne}from"./LoadingButton-caa486e8.js";import{D as se}from"./Delete-e33b6966.js";import"./RowCRUD-b35830b8.js";import"./TableRow-52fc41de.js";import"./TableContainer-10b5223d.js";import"./TableHead-f4539647.js";import"./Autocomplete-7a426b1a.js";import"./CircularProgress-eeae7465.js";import"./SelectCustom-ab67c468.js";import"./MenuItem-d8a67f6c.js";const ie=async d=>{try{return(await q.get("/sede",{headers:{"x-token":d}})).data}catch(a){throw a}},z=async({token:d,nombre:a,direccion:o})=>{try{return(await q.post("/sede",{nombre:a,direccion:o},{headers:{"x-token":d}})).data}catch(n){throw n}},ce=async(d,a)=>{try{return(await q.delete(`/sede/${a}`,{headers:{"x-token":d}})).data}catch(o){throw o}},de=(d={})=>{const a=_(),[o,n]=c.useState(d),{createAlert:l,editAlert:b,deleteAlert:h}=oe(),[u,g]=c.useState([]),[f,y]=c.useState([]),[v,x]=c.useState([]),{token:m}=j(t=>t.user),{departamentos:D}=j(t=>t.utilities),[p,s]=c.useState(!1);return{...o,formState:o,setFormState:n,onInputChange:({target:t})=>{const{name:r,value:e}=t;n({...o,[r]:e})},onResetForm:()=>{n(d)},sedes:u,getListSedes:async()=>{try{a($());const t=await ie(m);return g(t||[]),a(A()),t||[]}catch(t){T(t),a(A())}},onCreateSede:async t=>{l("esta sede","Sede Registrada",async()=>{try{a(I());const r=await z({token:m,nombre:o.nombreSede,direccion:{direccionExacta:o.direccion,distrito:o.distrito,provincia:o.provincia,departamento:o.departamento}});g([...u,r]),a(N())}catch(r){throw r}},t)},onDelete:async(t,r)=>{h("esta sede","Sede Eliminada",async()=>{try{a(I());const e=await ce(m,t);g([...u.filter(S=>S.uuid!==t)]),a(N())}catch(e){throw e}},r)},onEditSede:async t=>{b("esta sede",async()=>{try{a(I());const r=await z({token:m,nombre:o.nombreSede,direccion:{direccionExacta:o.direccion,distrito:o.distrito,provincia:o.provincia,departamento:o.departamento}});g([...u,r]),a(N())}catch(r){throw r}},t)},departamentos:D,provincias:f,distritos:v,getListProvincias:async t=>{try{s(!0);const r=await J(m,t);return y(r),s(!1),r}catch(r){a(A()),T(r),s(!1)}},getListDistritos:async(t,r)=>{try{s(!0);const e=await K(m,t,r);return x(e),s(!1),e}catch(e){a(A()),T(e),s(!1)}},loading:p}},le=({formSede:d,open:a,handleClose:o})=>{const{onInputChange:n,formState:l,onCreateSede:b,departamentos:h,provincias:u,distritos:g,getListDistritos:f,getListProvincias:y,loading:v}=d,[x,m]=c.useState(l.departamento),[D,p]=c.useState(l.provincia),[s,L]=c.useState(l.distrito),B=[...h.map(e=>e.departamento)],[F,k]=c.useState([...u.map(e=>e.provincia)]),[R,P]=c.useState([...g.map(e=>e.distrito)]),G=e=>{e.target.value!=""&&e.target.value!=null&&(m(e.target.value),p(""),L(""),P([]),k([]),y(h.find(S=>S.departamento==e.target.value).ubigeoId).then(S=>{k([...S.map(E=>E.provincia)]),n(e)}))},M=e=>{if(e.target.value!=""&&e.target.value!=null){p(e.target.value),L(""),P([]);const S=h.find(C=>C.departamento==l.departamento).ubigeoId,E=u.find(C=>C.provincia==e.target.value).ubigeoId;f(S,E).then(C=>{P([...C.map(H=>H.distrito)]),n(e)})}else n(e)},t=e=>{e.target.value!=""&&e.target.value!=null&&(L(e.target.value),n(e))};return i(Q,{open:a,handleClose:o,title:"Agregar Sede",children:i(O,{sx:{px:3,pb:3},children:w("form",{style:{flex:1},onSubmit:e=>{e.preventDefault(),b(o)},children:[w(O,{sx:me,children:[i(V,{sx:{flex:5,minWidth:150},size:"small",margin:"normal",name:"nombreSede",color:"secondary",label:"Nombre de la sede",required:!0,value:l.nombreSede,onChange:n}),i(W,{label:"Departamento",name:"departamento",value:x,onChange:G,options:B,required:!0}),i(W,{required:!0,label:"Provincia",name:"provincia",value:D,onChange:M,options:F,loading:v}),i(W,{required:!0,label:"Distrito",name:"distrito",value:s,onChange:t,options:R,loading:v}),i(re,{formState:l,onInputChange:n})]}),i(ne,{fullWidth:!0,type:"submit",variant:"contained",color:"primary",sx:{mt:2,alignSelf:"flex-end"},children:"Agregar Sede"})]})})})},me={flex:1,display:"flex",flexDirection:"column",gap:"0px 24px",flexWrap:"wrap"},Ne=({toggleDrawer:d})=>{const{token:a}=j(p=>p.user),n=de({token:a,nombreSede:"",direccion:"",distrito:"",provincia:"",departamento:""}),{sedes:l,getListSedes:b,onDelete:h}=n,[u,g]=c.useState(!1),[f,y]=c.useState([]),v=()=>{g(!0)},x=()=>{g(!1)},m=(p=[])=>[...p.map(s=>({uuid:s.uuid,nombre:s.nombre,provincia:s.direccion.provincia,distrito:s.direccion.distrito,departamento:s.direccion.departamento,direccion:s.direccion.direccion_exacta}))],D=[i(ae,{action:p=>{h(f[p].uuid,x)},children:i(se,{})})];return c.useEffect(()=>{b()},[]),c.useEffect(()=>{y(m(l))},[l]),w(ee,{title:"Configuración Global",toggleDrawer:d,children:[i(U,{gap:2,maxHeight:"100%",width:"100%",children:w(X,{sx2:{gap:2,flexDirection:"column",maxWidth:"100%"},children:[w(U,{maxWidth:"100%",flexDirection:"row",justifyContent:"space-between",children:[i(Y,{variant:"body1",fontWeight:"medium",textAlign:"start",children:"Sedes"}),i(Z,{sx:{width:"100px"},variant:"contained",color:"primary",onClick:v,children:" Agregar"})]}),i(te,{data:f,headers:ue,dataTypes:pe,extraActions:D})]})}),i(le,{formSede:n,handleClose:x,open:u})]})},pe=["nombre","departamento","provincia","distrito","direccion"],ue=[{name:"Nombre",align:"center"},{name:"Departamento",align:"center"},{name:"Provincia",align:"center"},{name:"Distrito",align:"center"},{name:"Dirección",align:"center"}];export{Ne as default};
