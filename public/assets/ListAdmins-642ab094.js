import{t as v,e as R,r as h,g as D,ai as j,aj as E,ae as N,s as P,o as k,b as e,y as O,j as b,l as x,K as U,p as G,q as _}from"./index-b05c3593.js";import{P as $}from"./Page-87bac860.js";import{T as B}from"./TableCRUDMini-8ef25830.js";import{C as q}from"./CustomActionCRUD-56f80e1a.js";import{g as z}from"./GlobalAlerts-e291f7f6.js";/* empty css               */import{b as H,c as K,M as Y,D as J,S as Q,C as V,d as X,e as Z}from"./TextfieldsTools-ddad1e93.js";import{C as ee}from"./CaptionBox-53db12e8.js";import{T as te}from"./Tooltip-8a46e05f.js";import{L as M}from"./LoadingButton-caa486e8.js";import{D as re}from"./Delete-e33b6966.js";import"./RowCRUD-b35830b8.js";import"./TableRow-52fc41de.js";import"./TableContainer-10b5223d.js";import"./TableHead-f4539647.js";import"./SelectCustom-ab67c468.js";import"./MenuItem-d8a67f6c.js";import"./CircularProgress-eeae7465.js";import"./Info-b8afdcbc.js";const ae=async(d,r)=>{try{return(await v.get("/admin",{headers:{"x-token":d}})).data}catch(a){throw a}},oe=async(d,r)=>{try{return(await v.delete(`/admin/${r}`,{headers:{"x-token":d}})).data}catch(a){throw a}},ne=async({token:d,dni:r,nombres:a,ape_paterno:m,ape_materno:c,celular:o,correo:t,sede:u,usuario:g,password:i})=>{try{return(await v.post("/admin",{dni:r,nombres:a,apePaterno:m,apeMaterno:c,celular:o,correo:t,sedeUuid:u,usuario:g,password:i},{headers:{"x-token":d}})).data}catch(f){throw f}},se=(d={})=>{const r=R(),[a,m]=h.useState(d),[c,o]=h.useState([]),{token:t}=D(s=>s.user),{sedes:u}=D(s=>s.utilities),{createAlert:g,editAlert:i,deleteAlert:f}=z();return{...a,formState:a,setFormState:m,onInputChange:({target:s})=>{const{name:n,value:A}=s;m({...a,[n]:A})},onResetForm:()=>{m(d)},onSubmit:async s=>{g("este administrador","Administrador Registrado",async()=>{try{r(P());const n=await ne({...a,token:t});o([...c,n]),r(k())}catch(n){throw n}},s)},data:c,sedes:u,getListAdmins:async s=>{try{r(j());const n=await ae(t,s);return o(n?n.admins:[]),r(E()),n||[]}catch(n){N(n),r(E())}},OndeleteAdmin:async(s,n)=>{f("este administrador","Administrador Eliminado",async()=>{try{r(P());const A=await oe(t,s);o([...c.filter(C=>C.uuid!==s)]),r(k())}catch(A){throw A}},n)}}},ie=({formAdmin:d,open:r,handleClose:a,isLoading:m,selected:c})=>{const{onInputChange:o,formState:t,onSubmit:u,sedes:g,setFormState:i}=d,f=g.map(S=>({label:S.nombre,value:S.uuid}));return e(O,{open:r,handleClose:a,title:c?"Editar Administrador":"Agregar Administrador",children:b(x,{component:"form",sx:{px:3,minWidth:300,maxHeight:"100%",height:"100%",overflowY:"auto",gap:2},onSubmit:S=>{S.preventDefault(),u(a)},children:[b(x,{children:[b(x,{direction:"row",columnGap:3,flexWrap:"wrap",children:[e(H,{formState:t,onInputChange:o,setFormState:i}),e(K,{formState:t,onInputChange:o,setFormState:i}),e(Y,{formState:t,onInputChange:o,setFormState:i}),e(J,{formState:t,onInputChange:o,setFormState:i})]}),e(U,{sx:{mt:1}}),b(x,{flexDirection:"row",columnGap:3,children:[b(x,{flex:1,columnGap:3,flexWrap:"wrap",children:[e(Q,{formState:t,onInputChange:o,options:f}),e(V,{formState:t,onInputChange:o,setFormState:i}),e(X,{formState:t,onInputChange:o,setFormState:i})]}),b(x,{flex:1,columnGap:3,flexWrap:"wrap",children:[e(G,{margin:"normal",required:!0,fullWidth:!0,id:"email",color:"secondary",label:"Usuario",name:"usuario",variant:"outlined",size:"small",value:t.usuario,onChange:o}),e(Z,{formState:t,onInputChange:o,setFormState:i})]})]})]}),e(te,{title:t.error?"Corrija todos los errores":"",children:c?e(M,{fullWidth:!0,loading:m,type:"submit",variant:"contained",color:"primary",sx:{alignSelf:"flex-end"},disabled:t.error,children:"Editar Administrador"}):e(M,{fullWidth:!0,loading:m,disabled:t.error,type:"submit",variant:"contained",color:"primary",sx:{alignSelf:"flex-end"},children:"Agregar Administrador"})}),e(ee,{text:"Solo puede agregar un administrador por sede."})]})})},ke=({toggleDrawer:d})=>{const[r,a]=h.useState([]),[m,c]=h.useState(null),{isLoading:o,token:t,user:u}=D(p=>p.user),[g,i]=h.useState(!1),w=se({token:t,ape_materno:"",ape_paterno:"",dni:"",nombres:"",celular:"",correo:"",usuario:"",password:"",confirmPassword:"",confirmNewPassword:"",sede:""}),{formState:S,setFormState:T,onResetForm:F,data:y,getListAdmins:s,OndeleteAdmin:n,sedes:A}=w;[...A.map(p=>({label:p.nombre,value:p.uuid}))],h.useState(u.rol?A[0].uuid:u.sede.uuid);const C=p=>p.map(l=>({usuario:l.usuario.usuario,uuid:l.uuid,nombres:`${l.nombres} ${l.ape_paterno} ${l.ape_materno}`,dni:l.dni,correo:l.correo,celular:l.celular,sede:l.sede?l.sede.nombre:"-"})),W=()=>{i(!0)},L=()=>{F(),i(!1),c(null)},I=[e(q,{action:p=>{n(r[p].uuid,L)},children:e(re,{})})];return h.useEffect(()=>{s()},[]),h.useEffect(()=>{a(C(y))},[y]),e($,{title:"Administradores",Actions:e(_,{sx:{width:"100px"},variant:"contained",color:"primary",onClick:W,children:" Agregar"}),toggleDrawer:d,children:b(x,{gap:2,children:[e(B,{data:r,headers:me,dataTypes:de,extraActions:I}),e(ie,{formAdmin:w,handleClose:L,isLoading:o,open:g,selected:m})]})})},de=["usuario","dni","nombres","celular","correo","sede"],me=[{name:"Usuario",align:"center"},{name:"DNI",align:"center"},{name:"Nombres",align:"center"},{name:"Celular",align:"center"},{name:"Correo",align:"center"},{name:"Sede",align:"center"}];export{ke as default};
