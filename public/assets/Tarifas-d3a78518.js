import{e as Q,r as f,g as D,ai as I,aj as b,ae as R,au as X,av as Y,s as M,aw as Z,o as q,ax as _,ay as aa,b as e,y as ea,B as N,j,p as ta,S as ra,q as oa,l as O}from"./index-b05c3593.js";import{P as sa}from"./Page-87bac860.js";import{T as ia}from"./TableCRUDMini-8ef25830.js";import{C as U}from"./CustomActionCRUD-56f80e1a.js";import{g as na}from"./GlobalAlerts-e291f7f6.js";import{a as da}from"./careers.service-c54b684b.js";import{C as $}from"./CustomSelectSearchLabel-0730f57a.js";/* empty css               */import{S as z}from"./SelectCustom-ab67c468.js";import{I as la}from"./InputAdornment-b1693cda.js";import{L as V}from"./LoadingButton-caa486e8.js";import{C as ca}from"./CaptionBox-53db12e8.js";import{E as ua}from"./Edit-18203eee.js";import{D as ma}from"./Delete-e33b6966.js";import"./RowCRUD-b35830b8.js";import"./TableRow-52fc41de.js";import"./TableContainer-10b5223d.js";import"./TableHead-f4539647.js";import"./Autocomplete-7a426b1a.js";import"./Tooltip-8a46e05f.js";import"./MenuItem-d8a67f6c.js";import"./CircularProgress-eeae7465.js";import"./Info-b8afdcbc.js";const fa=(h={})=>{const t=Q(),[n,i]=f.useState(h),[d,l]=f.useState([]),[c,v]=f.useState([]),{sedes:S}=D(a=>a.utilities),{token:m}=D(a=>a.user),{createAlert:T,editAlert:x,deleteAlert:y}=na();return{...n,formState:n,setFormState:i,onInputChange:({target:a})=>{const{name:r,value:u}=a;i({...n,[r]:u})},onResetForm:()=>{i(h)},onSubmit:async a=>{T("esta tarifa","Tarifa Registrada",async()=>{try{t(M());const r=await aa({...n,token:m});l([...d,r]),t(q())}catch(r){throw r}},a)},data:d,sedes:S,carreras:c,getListCareers:async()=>{try{t(I());const a=await da(m,n.sede?n.sede:S[0].uuid);return v(a),t(b()),a}catch(a){t(b()),R(a)}},getListTarifas:async()=>{try{t(I());const a=await X(m);return l(a),t(b()),a}catch(a){R(a),t(b())}},onEditTarifa:async(a,r)=>{x("esta tarifa",async()=>{try{t(M());const u=await _(m,a,n.tarifa);l([...d.map(g=>g.uuid==u.uuid?{...g,...u}:g)]),t(q())}catch(u){throw u}},r)},onDeleteTarifa:async(a,r)=>{y("esta tarifa","Tarifa Eliminada",async()=>{try{t(M());const u=await Z(m,a);l(d.filter(g=>g.uuid!=a)),t(q())}catch(u){throw u}},r)},getListTarifasBySede:async a=>{try{t(I());const r=await Y(m,a);return l(r),t(b()),r}catch(r){R(r),t(b())}}}},pa=({formModal:h,open:t,handleClose:n,isLoading:i,selected:d})=>{const{onInputChange:l,formState:c,onSubmit:v,sedes:S,onEditTarifa:m,carreras:T,data:x}=h,{user:y}=D(s=>s.user),L=x.map(s=>({uuid:s.carrera.uuid,modalidad:s.modalidad})),A=S.map(s=>({label:s.nombre,value:s.uuid})),w=[...T.map(s=>({label:s.nombre,value:s.uuid}))];return e(ea,{open:t,handleClose:n,title:d?"Editar Tarfia":"Agregar Tarifa",children:e(N,{sx:{px:3,pb:3,width:"300px"},children:e("form",{style:{flex:1},onSubmit:s=>{s.preventDefault(),d?m(d,n):L.some(C=>C.uuid==c.carrera&&C.modalidad==c.modo)?ra.fire({title:"Tarifa repetida",icon:"error",timer:2e3,confirmButtonColor:"#FED800"}):v(n)},children:j(N,{sx:ga,children:[e($,{required:!0,label:"Carrera",name:"carrera",value:c.carrera,onChange:l,options:w,flex:2,disabled:d!=null}),e(z,{required:!0,label:"Sede",name:"sede",value:c.sede,onChange:l,opts:A,disabled:y.rol==null}),e(z,{label:"Modalidad",name:"modo",value:c.modo,onChange:l,opts:ha,disabled:d!=null,required:!0}),e(ta,{margin:"normal",sx:{flex:1,minWidth:"150px"},name:"tarifa",label:"Tarifa",variant:"outlined",size:"small",color:"secondary",value:c.tarifa,onChange:l,required:!0,InputProps:{startAdornment:e(la,{position:"start",children:"S/."})}}),d?e(V,{fullWidth:!0,loading:i,type:"submit",variant:"contained",color:"primary",sx:{mt:2,alignSelf:"flex-end"},children:"Editar Tarifa"}):e(V,{fullWidth:!0,loading:i,type:"submit",variant:"contained",color:"primary",sx:{mt:2,alignSelf:"flex-end"},children:"Agregar Tarifa"})]})})})})},ga={flex:1,display:"flex",flexDirection:"column",gap:"0px 24px",flexWrap:"wrap"},ha=[{label:"Virtual",value:"virtual"},{label:"Presencial",value:"presencial"}],za=({toggleDrawer:h})=>{const{token:t,isLoading:n,user:i}=D(o=>o.user),d={token:t,carrera:"",tarifa:"",sede:i.rol?null:i.sede.uuid,modo:""},l=fa(d),{data:c,getListTarifas:v,onDeleteTarifa:S,sedes:m,onResetForm:T,setFormState:x,formState:y,carreras:L,getListCareers:A,getListTarifasBySede:w}=l,E=[...m.map(o=>({label:o.nombre,value:o.uuid}))],[s,C]=f.useState(i.rol?E[0].value:i.sede.uuid),[k,B]=f.useState(null),a=({target:o})=>{o.value!=""&&C(o.value)},[r,u]=f.useState([]),[g,F]=f.useState(!1),G=()=>{F(!0)},P=()=>{T(),F(!1),B(null)},H=o=>{F(!0),B(r[o].uuid);const p=c.find(K=>K.uuid==r[o].uuid);x({...y,carrera:p.carrera.uuid,tarifa:p.tarifa,sede:i.sede.uuid,modo:p.modalidad})},J=[e(U,{action:o=>{H(o)},children:e(ua,{})}),e(U,{action:o=>{S(r[o].uuid,P)},children:e(ma,{})})],W=(o=[])=>o.map(p=>({uuid:p.uuid,carrera:p.carrera.nombre,tarifa:`S/. ${p.tarifa}`,modalidad:p.modalidad}));return f.useEffect(()=>{A()},[]),f.useEffect(()=>{w(s).then(o=>{u(W(o))})},[s]),f.useEffect(()=>{u(W(c))},[c]),j(sa,{title:"Tarifas",Actions:e(oa,{sx:{width:"100px"},variant:"contained",color:"primary",onClick:G,children:" Agregar"}),toggleDrawer:h,children:[j(O,{flex:1,gap:2,children:[e(O,{flexDirection:"row",gap:3,justifyContent:"space-between",alignItems:"center",width:200,children:e($,{required:!0,label:"Sede",name:"sede",value:s,onChange:a,options:E,disabled:i.rol?!1:i.usuario.rol.nombre=="Administrador"})}),e(ia,{data:r,dataTypes:Sa,headers:ba,extraActions:J}),e(pa,{formModal:l,handleClose:P,open:g,isLoading:n,selected:k})]}),e(ca,{text:"Registre una tarifa por carrera dependiendo de su modalidad y sede."})]})},Sa=["carrera","tarifa","modalidad"],ba=[{name:"Carrera",align:"center"},{name:"Tarifa",align:"center"},{name:"Modalidad",align:"center"}];export{za as default};
