import{e as Ua,r as m,f as Sa,g as N,ai as D,bu as va,aj as d,bv as Ra,ae as u,A as Ea,bw as Ia,ak as $,al as J,s as f,bx as Ta,o as l,by as Aa,S as w,bz as Fa,O as R,bA as La,aJ as E,bB as ka,bC as za}from"./index-b05c3593.js";import{g as Na}from"./schedule.service-5bfabb81.js";import{g as $a}from"./GlobalAlerts-e291f7f6.js";import{a as Ja}from"./specialization.service-3d04622c.js";import{g as j}from"./careers.service-c54b684b.js";import{e as B}from"./utilities-59a1cf49.js";const Xa=(I={})=>{const r=Ua(),[a,p]=m.useState(I),[H,T]=m.useState([]),[O,A]=m.useState([]),[V,P]=m.useState([]),[q,G]=m.useState([]),[K,Q]=m.useState([]),[M,W]=m.useState(null),x=Sa(),[X,Y]=m.useState([]),[U,C]=m.useState(null),[F,Z]=m.useState([]),{grados:aa,tipoPago:ea,sedes:oa,departamentos:L,modulos:ta,secretarias:ra,matriculaStore:h}=N(o=>o.utilities),{token:s}=N(o=>o.user),[ia,c]=m.useState(!1),{createAlert:S,editAlert:na,deleteAlert:Ha,customAlert:ca}=$a(),sa=async o=>{try{r(D());const t=await j(s,a.sede),i=await va(s,o),e=i.matricula?i.matricula:i;return P([...t.find(n=>n.uuid==e.carrera.uuid).modulos]),await _(e.alumno.direccion.departamento,e.alumno.direccion.provincia),p({...a,uuid:e.uuid,nombres:e.alumno.nombres,ape_paterno:e.alumno.ape_paterno,ape_materno:e.alumno.ape_materno,celular:e.alumno.celular,celReferencia:e.alumno.celular_referencia??"",correo:e.alumno.correo??"",edad:e.alumno.edad,dni:e.alumno.dni,sexo:e.alumno.sexo,grado:e.alumno.grado_estudios.uuid,departamento:e.alumno.direccion.departamento,provincia:e.alumno.direccion.provincia,distrito:e.alumno.direccion.distrito,direccion:e.alumno.direccion.direccion_exacta,residencia:e.alumno.lugar_residencia,carrera:e.carrera.nombre,tipoCarre:e.carrera.tipo_carrera,modulos:e.matriculaModulosModulo.filter(n=>n.estado=="matriculado"||n.estado=="matriculado_culminado"),sede:e.sede.uuid,tipoPago:e.pagoMatricula?e.pagoMatricula.forma_pago:"",nroDocu:e.pagoMatricula?e.pagoMatricula.num_comprobante:"",entidad:e.pagoMatricula?e.pagoMatricula.entidad:"",monto:e.pagoMatricula?e.pagoMatricula.monto:0,imgDoc:e.pagoMatricula?e.pagoMatricula.foto_comprobante:null,responsable:e.secretaria.nombres}),C(e||null),r(d()),e}catch{return r(d()),C(-1),null}},da=async()=>{try{r(D());const o=await Ra(a);return Y(o||[]),r(d()),o}catch(o){u(o),r(d())}},ua=()=>{p({...a,token:s,carrera:"",modulo:"",modo:"",horario:""})},v=async o=>{window.open(`${Ea}/matricula/generate-pdf/${o}`,"_blank")},k=async()=>{try{c(!0);const o=await Ja(s);G(o),c(!1)}catch(o){r(d()),u(o),c(!1)}},la=async o=>{try{c(!0);const t=await Na(s);Q(t),c(!1)}catch(t){r(d()),u(t),c(!1)}},ma=async o=>{try{c(!0);const t=await Ia(s,o);return P(t||[]),c(!1),t}catch(t){r(d()),u(t),c(!1)}},pa=async o=>{try{c(!0);const t=await $(s,o);return T(t),c(!1),t}catch(t){r(d()),u(t),c(!1)}},fa=async(o,t)=>{try{c(!0);const i=await J(s,o,t);return A(i),c(!1),i}catch(i){r(d()),u(i),c(!1)}},_=async(o,t)=>{try{c(!0);const i=L.find(y=>y.departamento==o).ubigeoId,e=await $(s,i),n=e.find(y=>y.provincia==t).ubigeoId,g=await J(s,i,n);T(e),A(g),c(!1)}catch(i){r(d()),u(i),c(!1)}},ga=()=>{p(I)},ha=({target:o})=>{const{name:t,value:i}=o;p({...a,[t]:i})},wa=o=>{W(o),p({...a,imgDoc:o})},Ma=async(o,t)=>{o.preventDefault(),na("esta matricula",async()=>{try{r(f());let i={uuid:a.uuid,token:s,tipoMatricula:a.tipo,alumno:{dni:a.dni,nombres:a.nombres,apePaterno:a.ape_paterno,apeMaterno:a.ape_materno,sexo:a.sexo,edad:a.edad,gradoEstudiosUuid:a.grado,lugarResidencia:a.residencia,celularReferencia:a.celReferencia==""?void 0:a.celReferencia,celular:a.celular,correo:a.correo==""?void 0:a.correo,direccion:{direccionExacta:a.direccion,distrito:a.distrito,provincia:a.provincia,departamento:a.departamento}},modulos:a.modulos.map(n=>({uuid:n.uuid,moduloUuid:n.modulo.uuid,modalidad:n.modalidad,fechaInicio:new Date(n.fecha_inicio),horarioUuid:n.horario.uuid}))};const e=await Ta(i);e&&p({...a,uuid:e.uuid,nombres:e.alumno.nombres,ape_paterno:e.alumno.ape_paterno,ape_materno:e.alumno.ape_materno,celular:e.alumno.celular,celReferencia:e.alumno.celular_referencia,correo:e.alumno.correo,edad:e.alumno.edad,dni:e.alumno.dni,sexo:e.alumno.sexo,grado:e.alumno.grado_estudios.uuid,departamento:e.alumno.direccion.departamento,provincia:e.alumno.direccion.provincia,distrito:e.alumno.direccion.distrito,direccion:e.alumno.direccion.direccion_exacta,residencia:e.alumno.lugar_residencia,carrera:e.carrera.nombre,tipoCarre:e.carrera.tipo_carrera,modulos:e.matriculaModulosModulo.filter(n=>n.estado=="matriculado"||n.estado=="matriculado_culminado"),sede:e.sede.uuid,tipoPago:e.pagoMatricula?e.pagoMatricula.forma_pago:"",nroDocu:e.pagoMatricula?e.pagoMatricula.num_comprobante:"",entidad:e.pagoMatricula?e.pagoMatricula.entidad:"",monto:e.pagoMatricula?e.pagoMatricula.monto:0,imgDoc:e.pagoMatricula?e.pagoMatricula.foto_comprobante:null,responsable:e.secretaria.nombres}),C(e),r(l())}catch(i){throw i}},t)},ba=async o=>{ca("¿Estas seguro de importar esta Matricula?","Matricula importada",async()=>{try{const t=new Date;let i={token:a.token,tipoMatricula:a.tipo,alumno:{dni:a.dni,nombres:a.nombres,apePaterno:a.ape_paterno,apeMaterno:a.ape_materno,sexo:a.sexo,edad:a.edad,gradoEstudiosUuid:a.grado,lugarResidencia:a.residencia,celularReferencia:a.celReferencia==""?void 0:a.celReferencia,celular:a.celular,correo:a.correo==""?void 0:a.correo,direccion:{direccionExacta:a.direccion,distrito:a.distrito,provincia:a.provincia,departamento:a.departamento}},carreraUuid:a.carrera,modulosCompletados:a.modulos.map(n=>n.uuid),secretariaUuid:a.responsableUuid,sedeUuid:a.sede,fechaInscripcion:t,fechaInicio:new Date};a.pendiente||(i={...i,pagoMatricula:{numComprobante:a.nroDocu,entidad:a.entidad==""?"oficina":a.entidad,formaPagoUuid:a.tipoPago,monto:Math.floor(Number(a.monto)),fecha:new Date(a.fechaPago),hora:a.horaPago!="00:00"?a.horaPago:B(new Date)}}),r(f());const e=await Aa(i);a.imgDoc&&await b(e.uuid),r(l())}catch(t){throw t}},o)},ya=async o=>{const t=F.find(n=>n.uuid==a.carrera).tipo_carrera,i=new Date;let e={token:s,tipoMatricula:a.tipo,alumno:{dni:a.dni,nombres:a.nombres,apePaterno:a.ape_paterno,apeMaterno:a.ape_materno,sexo:a.sexo,edad:a.edad,gradoEstudiosUuid:a.grado,lugarResidencia:a.residencia,celularReferencia:a.celReferencia==""?void 0:a.celReferencia,celular:a.celular,correo:a.correo==""?void 0:a.correo,direccion:{direccionExacta:a.direccion,distrito:a.distrito,provincia:a.provincia,departamento:a.departamento}},carreraUuid:a.carrera,modulos:a.modulos.map(n=>({uuid:n.modulo,modalidad:n.modalidad,fechaInicio:new Date(n.inicio),horarioUuid:n.horario})),secretariaUuid:a.responsableUuid,sedeUuid:a.sede,fechaInscripcion:i,fechaInicio:new Date,tipo_carrera:t};a.pendiente||(e={...e,pagoMatricula:{numComprobante:a.nroDocu,entidad:a.entidad==""?"oficina":a.entidad,formaPagoUuid:a.tipoPago,monto:Math.floor(Number(a.monto)),fecha:new Date(a.fechaPago),hora:a.horaPago!="00:00"?a.horaPago:B(new Date)}}),w.fire({title:"¿Estas seguro de registrar esta matricula?",showCancelButton:!0,confirmButtonText:"Aceptar",denyButtonText:"Cancelar",cancelButtonColor:"#EB3C3C",icon:"warning",confirmButtonColor:"#2BB128"}).then(async n=>{if(n.isConfirmed)try{r(f());const g=await Fa(e);a.imgDoc&&await b(g.uuid),r(l()),w.fire({title:"¡Matricula Completa!",icon:"success",cancelButtonText:"Aceptar",confirmButtonText:"Imprimir ficha",showCancelButton:!0,cancelButtonColor:"#7D7D7D",confirmButtonColor:"#0F0F0F",willClose:()=>{r(R({matricula:null})),x("/home/matricula/listado")}}).then(y=>{y.isConfirmed&&v(g.uuid)})}catch(g){r(l()),u(g)}})},Da=async o=>{const t=new Date;let i={token:s,tipoMatricula:a.tipo,alumno:{dni:a.dni,nombres:a.nombres,apePaterno:a.ape_paterno,apeMaterno:a.ape_materno,sexo:a.sexo,edad:a.edad,gradoEstudiosUuid:a.grado,lugarResidencia:a.residencia,celular:a.celular,celularReferencia:a.celReferencia==""?void 0:a.celReferencia,correo:a.correo==""?void 0:a.correo,direccion:{direccionExacta:a.direccion,distrito:a.distrito,provincia:a.provincia,departamento:a.departamento}},especializacionUuid:a.especialidad,secretariaUuid:a.responsableUuid,sedeUuid:a.sede,fechaInscripcion:t,horario:{dias:a.hora_inicio!=""?a.dias.map((e,n)=>ja[e]):[],horaInicio:a.hora_inicio!=""?a.hora_inicio:"",horaFin:a.hora_inicio!=""?a.hora_fin:""},fechaInicio:a.inicio!=""?new Date(a.inicio):void 0,modalidad:a.modo!=""?a.modo:void 0};a.pendiente||(i={...i,pagoMatricula:{numComprobante:a.nroDocu,formaPagoUuid:a.tipoPago,entidad:a.entidad,monto:Math.floor(Number(a.monto)),fecha:new Date(a.fechaPago),hora:a.horaPago!="00:00"?a.horaPago:B(new Date)}}),w.fire({title:"¿Estas seguro de registrar esta matricula?",showCancelButton:!0,confirmButtonText:"Aceptar",denyButtonText:"Cancelar",cancelButtonColor:"#EB3C3C",icon:"warning",confirmButtonColor:"#2BB128"}).then(async e=>{if(e.isConfirmed)try{r(f());const n=await La(i);a.imgDoc&&await b(n.uuid),r(l()),w.fire({title:"¡Matricula Completa!",icon:"success",cancelButtonText:"Aceptar",confirmButtonText:"Imprimir ficha",showCancelButton:!0,cancelButtonColor:"#7D7D7D",confirmButtonColor:"#0F0F0F",willClose:()=>{r(R({matricula:null})),x("/home/matricula/especialidades")}}).then(g=>{g.isConfirmed&&v(n.uuid)})}catch(n){r(l()),u(n)}})},Ca=async(o,t)=>{S("este documento","Documento Registrado",async()=>{try{r(f());const i=await E({token:s,image:M,uuid:o});r(l())}catch(i){throw i}},t)},_a=async(o,t)=>{S("este documento","Documento Subido",async()=>{try{r(f());const e=await E({token:s,image:M,uuid:o});if(M){var i=new FileReader;i.onload=function(n){C({...U,pagoMatricula:{...U.pagoMatricula,foto_comprobante:n.target.result}})},i.readAsDataURL(M)}r(l())}catch(e){throw e}},t)},b=async o=>{try{r(D());const t=await E({token:s,image:M,uuid:o});r(d())}catch(t){r(d()),u(t)}},Ba=async o=>{try{r(D());const t=await ka({token:s,dni:o});return r(d()),t}catch(t){return r(d()),u(t),null}},Pa=async o=>{try{r(f());const t={nombres:"prueba",ape_paterno:"prueba",ape_materno:"prueba",edad:12,dni:"12345678",sexo:"m",departamento:"Amazonas",provincia:"Luya",distrito:"Lamud",direccion:"direccion prueba"};return await _(t.departamento,t.provincia),p({...a,...t}),r(l()),w.fire({title:"Datos llenados",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#0F0F0F",timer:1500}),t}catch(t){return r(l()),u(t),null}},xa=async(o,t)=>{S("este Pago","Pago Registrado",async()=>{try{r(f()),await za({...a,fecha:new Date(a.fechaPago),hora:a.horaPago!="00:00"?a.horaPago:B(new Date),pagoUuid:o,entidad:a.entidad==""?"oficina":a.entidad},o),await b(o),r(l())}catch(i){throw i}},()=>{x(t?`/home/matricula/especialidades/${o}`:`/home/matricula/${o}`)})},z=async()=>{try{r(D());const o=await j(s,a.sede);return Z(o),r(d()),o}catch(o){r(d()),u(o),c(!1)}};return{...a,formState:a,onImageChange:wa,onInputChange:ha,onResetForm:ga,onSubmit:ya,onSubmitEspe:Da,onFill:Ba,onEdit:Ma,onAceptFil:Pa,onUploadDoc:b,departamentos:L,provincias:H,distritos:O,getListProvincias:pa,getListDistritos:fa,grados:aa,getListMatriculas:da,matriculas:X,carreras:F,getListCareers:z,getListSchedules:la,schedules:K,sedes:oa,tipoPago:ea,getpdf:v,modules:V,modulos:ta,resetFormCarrer:ua,getModules:ma,loading:ia,setFormState:p,setUbication:_,secretarias:ra,getListSpecializations:k,speacials:q,onRegisterPago:xa,matricula:U,getMatricula:sa,formUploadDoc:Ca,onUploadDocModal:_a,onInitial:async o=>{await k();const t=await z();h&&w.fire({title:"¿Desea continuar con el ultimo formulario?",showCancelButton:!0,confirmButtonText:"Continuar",cancelButtonText:"Reiniciar",cancelButtonColor:"#EB3C3C",icon:"warning",confirmButtonColor:"#2BB128"}).then(async i=>{if(i.isConfirmed){if(r(f()),h.carrera!=""){const e=t.find(n=>n.uuid==h.carrera);P(e?e.modulos:[])}await _(h.departamento,h.provincia),o(h.step),p(h),r(l()),w.fire({title:"Datos recuperados",icon:"success",timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"})}else r(R({matricula:null}))})},onTraslado:ba}},ja={0:"Lun",1:"Mar",2:"Mie",3:"Jue",4:"Vie",5:"Sab",6:"Dom"};export{Xa as u};
